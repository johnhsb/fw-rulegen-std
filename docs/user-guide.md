# 사용자 가이드

방화벽 정책 추천 시스템 사용자 가이드입니다. 이 문서는 시스템의 주요 기능과 사용 방법을 설명합니다.

## 목차

1. [시작하기](#시작하기)
2. [대시보드](#대시보드)
3. [로그 업로드](#로그-업로드)
4. [Syslog 서버 설정](#syslog-서버-설정)
5. [로그 분석](#로그-분석)
6. [정책 추천](#정책-추천)
7. [방화벽 설정 생성](#방화벽-설정-생성)
8. [시스템 설정](#시스템-설정)
9. [모범 사례](#모범-사례)

## 시작하기

### 1. 로그인

시스템에 접속하면 로그인 화면이 표시됩니다.

- 기본 계정: `admin` / `admin`
- 첫 로그인 후 반드시 비밀번호를 변경하세요

![로그인 화면](screenshots/login.png)

### 2. 첫 화면

로그인 후 대시보드가 표시됩니다. 주요 메뉴는 다음과 같습니다:

- **대시보드**: 시스템 상태 및 분석 결과 요약
- **로그 업로드**: 방화벽 로그 파일 업로드
- **Syslog 서버**: 실시간 로그 수집 설정
- **시스템 설정**: 분석 파라미터 및 시스템 설정

## 대시보드

대시보드는 시스템의 현재 상태와 분석 결과를 한눈에 보여줍니다.

### 주요 구성 요소

1. **트래픽 분석 결과**
   - 수동 업로드 분석 결과
   - Syslog 자동 분석 결과
   - 분석 날짜/시간 및 정책 수

2. **수집된 로그 파일**
   - 업로드된 로그 파일 목록
   - Syslog로 수집된 로그 파일 목록
   - 파일 크기 및 수정 시간

3. **시스템 상태**
   - Syslog 서버 실행 상태
   - 메모리/디스크 사용량

4. **활동 요약**
   - 총 분석 횟수
   - 로그 파일 수
   - 생성된 정책 수

## 로그 업로드

### 1. 파일 선택

1. 상단 메뉴에서 "로그 업로드" 클릭
2. "파일 선택" 버튼 클릭
3. 하나 이상의 로그 파일 선택 (최대 200MB)

### 2. 지원 로그 형식

```
Nov 20 15:30:45 fw-01 RT_FLOW: RT_FLOW_SESSION_CREATE: session created 192.168.1.10/54321->8.8.8.8/53 0x0 junos-dns-udp 192.168.1.10/54321->8.8.8.8/53 0x0 N/A N/A 17 trust-policy trust untrust 12345 N/A(N/A) eth0.0
```

- 주니퍼 방화벽 RT_FLOW 형식
- SESSION_CREATE/SESSION_CLOSE 이벤트
- IPv4 및 IPv6 지원

### 3. 업로드 진행

- 프로그레스 바로 업로드 진행률 확인
- 업로드 완료 후 "로그 분석 시작" 버튼 활성화

## Syslog 서버 설정

실시간으로 방화벽 로그를 수집하는 Syslog 서버를 설정합니다.

### 1. 서버 설정

1. "Syslog 서버" 메뉴 클릭
2. 다음 설정 입력:
   - **수신 주소**: 0.0.0.0 (모든 인터페이스)
   - **포트**: 514 (기본 Syslog 포트)
   - **자동 분석 주기**: 3600초 (1시간)
   - **장비명 필터**: 특정 장비만 수집 시 설정

### 2. 서버 시작

1. 설정 완료 후 "서버 시작" 버튼 클릭
2. 서버 상태가 "실행 중"으로 변경됨
3. 로그 콘솔에서 실시간 상태 확인

### 3. 방화벽 설정

주니퍼 방화벽에 다음 설정을 적용합니다:

```
set system syslog host <서버_IP>
set system syslog host transport udp
set system syslog host port 514
set system syslog host any any
set system syslog host structured-data
```

### 4. 자동 분석

- 설정된 주기마다 자동으로 로그 분석 실행
- 분석 결과는 대시보드에서 확인 가능

## 로그 분석

수집된 로그를 분석하여 트래픽 패턴을 식별합니다.

### 1. 분석 필터 설정

#### 기본 필터
- **날짜 범위**: 분석할 로그의 기간
- **노이즈 데이터 제외**: 불필요한 트래픽 제거

#### IP 필터
- **출발지 IP**: 특정 IP 주소 또는 서브넷
- **목적지 IP**: 특정 IP 주소 또는 서브넷
- 포함/제외 옵션 선택 가능

#### 네트워크 필터
- **포트**: 특정 포트 또는 포트 범위
- **프로토콜**: TCP, UDP, ICMP 등

#### 존 및 장비 필터
- **출발지 존**: trust, untrust 등
- **목적지 존**: dmz, internet 등
- **장비명**: 특정 방화벽 장비

### 2. 클러스터링 파라미터

DBSCAN 알고리즘 파라미터를 조정하여 분석 정밀도를 제어합니다:

- **최소 발생 횟수**: 분석에 포함할 최소 트래픽 수
- **eps (epsilon)**: 클러스터 간 최대 거리
- **최소 샘플 수**: 클러스터 형성에 필요한 최소 포인트
- **최대 데이터 포인트**: 메모리 제한을 위한 설정

### 3. 분석 실행

1. 필터 및 파라미터 설정 완료
2. "분석 시작" 버튼 클릭
3. 분석 진행 중 로딩 화면 표시
4. 완료 후 결과 페이지로 자동 이동

### 4. 분석 결과 확인

#### 상위 트래픽 패턴
- IPv4/IPv6 트래픽 별도 표시
- 출발지 서브넷, 목적지 IP, 포트 정보
- 발생 횟수 및 전체 대비 비율

#### 트래픽 흐름 다이어그램 (Sankey)
- 출발지와 목적지 간 트래픽 흐름 시각화
- 트래픽 양에 비례한 연결선 굵기
- 포트/프로토콜 정보 표시

#### 3D 트래픽 시각화
- 출발지 IP, 목적지 IP, 포트의 3차원 표현
- 클러스터별 색상 구분
- 트래픽 양에 비례한 점 크기

## 정책 추천

분석 결과를 바탕으로 최적화된 방화벽 정책을 추천합니다.

### 1. 정책 목록

- 클러스터별로 생성된 정책 표시
- 정책 이름, ID, 네트워크 정보
- 서비스/포트, 프로토콜, 존 정보

### 2. 정책 필터링

- 정책 이름으로 검색
- 프로토콜별 필터
- IP 버전별 필터 (IPv4/IPv6)

### 3. 정책 상세 정보

각 정책 카드에는 다음 정보가 포함됩니다:

- **출발지 네트워크**: CIDR 형식의 IP 범위
- **목적지 네트워크**: CIDR 형식의 IP 범위
- **서비스/포트**: Well-known 서비스 이름 또는 포트 번호
- **프로토콜**: TCP, UDP, ICMP 등
- **존**: 출발지 → 목적지 존 매핑
- **트래픽 양**: 관찰된 트래픽 수

### 4. 정책 편집

1. "수정" 버튼 클릭
2. 정책 정보 수정
3. "저장" 버튼으로 변경사항 적용

## 방화벽 설정 생성

추천된 정책을 기반으로 주니퍼 방화벽 설정을 자동 생성합니다.

### 1. 설정 보기

- "주니퍼 설정 보기" 버튼 클릭
- IPv4/IPv6 설정 탭 별도 표시
- 설정 내용 확인

### 2. 설정 내보내기

- **클립보드 복사**: 설정을 클립보드에 복사
- **파일 다운로드**: .txt 파일로 저장

### 3. 설정 검색

- 특정 키워드로 설정 내용 검색
- 매치된 부분 하이라이트 표시

### 4. 생성된 설정 구조

```
# 주소집합 정의
set security address-book global address src-policy-1 192.168.1.0/24

# 애플리케이션 정의
set applications application app-policy-1-tcp-0 protocol tcp
set applications application app-policy-1-tcp-0 destination-port 80-80

# 정책 정의
set security policies from-zone trust to-zone untrust policy policy-1
set security policies from-zone trust to-zone untrust policy policy-1 match source-address src-policy-1
set security policies from-zone trust to-zone untrust policy policy-1 match destination-address dst-policy-1
set security policies from-zone trust to-zone untrust policy policy-1 match application app-policy-1-tcp-0
set security policies from-zone trust to-zone untrust policy policy-1 then permit
```

## 시스템 설정

### 1. DBSCAN 클러스터링 파라미터

- **최소 발생 횟수**: 기본값 1
- **Epsilon 값**: 기본값 0.5
- **최소 샘플 수**: 기본값 2
- **최대 데이터 포인트**: 기본값 10000

### 2. 파일 저장 설정

- **출력 디렉토리**: 분석 결과 저장 위치
- **로그 디렉토리**: Syslog 파일 저장 위치
- **데이터 보관 일수**: 자동 삭제 기준

### 3. 데이터 관리

- **오래된 데이터 정리**: 설정된 기간 이상의 파일 삭제
- 정리 전 확인 메시지 표시

### 4. 시스템 정보

- 시스템 버전
- Python 버전
- 디스크 사용량
- 메모리 사용량

## 모범 사례

### 1. 로그 수집

- **정기적인 분석**: 최소 일 1회 분석 권장
- **적절한 필터링**: 불필요한 트래픽 제외
- **충분한 데이터**: 최소 7일 이상의 로그 분석

### 2. 분석 파라미터

- **보수적 시작**: 엄격한 파라미터로 시작
- **점진적 조정**: 필요에 따라 완화
- **메모리 고려**: 대용량 로그 시 max_data_points 조정

### 3. 정책 관리

- **정기적 검토**: 월 1회 정책 검토
- **테스트 적용**: 프로덕션 적용 전 테스트
- **백업 유지**: 기존 설정 백업 보관

### 4. 보안 고려사항

- **비밀번호 변경**: 기본 비밀번호 즉시 변경
- **접근 제어**: 최소 권한 원칙 적용
- **로그 보호**: 민감 정보 포함 가능

### 5. 성능 최적화

- **배치 분석**: 실시간보다 배치 처리 권장
- **필터 활용**: 분석 전 적극적 필터링
- **리소스 모니터링**: CPU/메모리 사용량 확인

## 문제 해결

### 일반적인 문제

1. **로그인 실패**
   - 사용자명/비밀번호 확인
   - 세션 타임아웃 확인

2. **업로드 실패**
   - 파일 크기 제한 확인 (200MB)
   - 파일 형식 확인

3. **분석 실패**
   - 로그 형식 확인
   - 메모리 부족 시 파라미터 조정

4. **Syslog 수신 안됨**
   - 방화벽 설정 확인
   - 네트워크 연결 확인
   - 포트 개방 확인

### 도움말

- 각 페이지의 도움말 섹션 참조
- 관리자에게 문의
- [GitHub 이슈](https://github.com/your-repo/issues) 등록

## 키보드 단축키

| 단축키 | 기능 |
|--------|------|
| Ctrl+S | 설정 저장 |
| Ctrl+F | 검색 |
| Esc | 모달 닫기 |

## 용어집

- **DBSCAN**: 밀도 기반 클러스터링 알고리즘
- **CIDR**: Classless Inter-Domain Routing
- **RT_FLOW**: 주니퍼 실시간 플로우 로그
- **존(Zone)**: 방화벽의 논리적 네트워크 구역
- **노이즈 포인트**: 클러스터에 속하지 않는 데이터
